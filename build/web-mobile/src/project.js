require=function t(i,e,o){function n(r,u){if(!e[r]){if(!i[r]){var h="function"==typeof require&&require;if(!u&&h)return h(r,!0);if(s)return s(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var a=e[r]={exports:{}};i[r][0].call(a.exports,function(t){var e=i[r][1][t];return n(e||t)},a,a.exports,t,i,e,o)}return e[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)n(o[r]);return n}({Demo:[function(t,i,e){"use strict";cc._RF.push(i,"0a50bJirc9JALN2ODc43pKx","Demo"),cc.Class({extends:cc.Component,properties:{squarePrefab:cc.Prefab,rows:10,cols:10,mines:10,squareSize:35,lblSeconds:cc.Label,lblWin:cc.Label,audioExplode:{default:null,url:cc.AudioClip},audioWin:{default:null,url:cc.AudioClip},audioClick:{default:null,url:cc.AudioClip},audioFlag:{default:null,url:cc.AudioClip},audioOpening:{default:null,url:cc.AudioClip}},start:function(){this.seconds=-1,this.initTouchEvent(),this.newGame()},newGame:function(){this.lblWin.node.active=!1,this.seconds=-1,this.showSeconds(0),this.removeEventListener(),this.removeLastSquares(),this.squaresRevealed=0,this.minesFlagged=0,this.initialize()},initialize:function(){this.setBoardSize(),this.addEventListener(),this.instantiateSquares(),this.generateMines()},setBoardSize:function(){var t=this.cols*this.squareSize,i=this.rows*this.squareSize;this.node.width=t,this.node.height=i},removeLastSquares:function(){if(this.map)for(var t=0;t<this.rows;t++)for(var i=0;i<this.cols;i++)this.node.removeChild(this.map[t][i].node)},instantiateSquares:function(){this.map=new Array(this.rows);for(var t=0;t<this.rows;t++)this.map[t]=new Array(this.cols);var i=this.squareSize,e=this.cols*i,o=this.rows*i;for(t=0;t<this.rows;t++)for(var n=0;n<this.cols;n++){var s=cc.instantiate(this.squarePrefab).getComponent("Square");this.node.addChild(s.node),s.board=this,s.init(t,n,i);var r=n*i-e/2+i/2,u=t*i-o/2+i/2;s.node.setPosition(cc.p(r,u)),this.map[t][n]=s}this.squaresRevealed=0},generateMines:function(){var t=this.mines;do{var i=Math.floor(Math.random(5e3)*(this.rows*this.cols-1)),e=Math.floor(i/this.cols),o=i%this.cols;this.map[e][o].isMine||(this.map[e][o].isMine=!0,t-=1)}while(t>0)},regenerate:function(t){for(t.row,t.col;t.getSurroundingMineCount()>0||t.isMine;){for(var i=0;i<this.rows;i++)for(var e=0;e<this.cols;e++)this.map[i][e].isMine=!1;this.generateMines()}},squaresRemaining:function(){return this.rows*this.cols-this.mines-this.squaresRevealed},initTouchEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(t){var i=this._convTouchSquare(t);i&&(this.touchDownSquare=i,this.scheduleOnce(this._waitingLongTouch,.4))},this),this.node.on(cc.Node.EventType.TOUCH_END,function(t){do{if(this.isLongTouch)break;var i=this._convTouchSquare(t);if(!i||!i.equal(this.touchDownSquare))break;this.node.emit("short-touch",{currentSquare:i})}while(0);this.unschedule(this._waitingLongTouch),this.touchDownSquare=null,this.isLongTouch=!1},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){var i=this._convTouchSquare(t);i&&i.equal(this.touchDownSquare)||this.unschedule(this._waitingLongTouch)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(t){this.unschedule(this._waitingLongTouch),this.touchDownSquare=null,this.isLongTouch=!1},this)},addEventListener:function(){this.node.on("long-touch",this._longTouch,this),this.node.on("short-touch",this._shortTouch,this)},removeEventListener:function(){this.node.off("long-touch",this._longTouch,this),this.node.off("short-touch",this._shortTouch,this)},_convTouchSquare:function(t){var i=this.node.convertTouchToNodeSpace(t),e=this.squareSize,o=Math.floor(i.y/e),n=Math.floor(i.x/e);return o>=this.rows||this.rows<0||n>=this.cols||this.cols<0?null:this.map[o][n]},_waitingLongTouch:function(){this.isLongTouch=!0,this.node.emit("long-touch",{currentSquare:this.touchDownSquare})},_longTouch:function(t){this.seconds<0&&(this.seconds=0);var i=t.detail.currentSquare;i.isRevealed||i.markWithFlag()},_shortTouch:function(t){this.seconds<0&&(this.seconds=0),this.playAudio("click");var i=t.detail.currentSquare;i.isRevealed?i.clearAround():i.uncoverSquare()},loseGame:function(t){this.playAudio("explode"),this.seconds=-1,this.removeEventListener(),this.uncoverAllMines(t)},winGame:function(){this.playAudio("win"),this.seconds=-1,this.removeEventListener(),this.uncoverAllMines(void 0),this.lblWin.node.active=!0},uncoverAllMines:function(t){t&&t.drawMine(!0);for(var i=this.rows,e=this.cols,o=0;o<i;o++)for(var n=0;n<e;n++){var s=this.map[o][n];!s.isMine||s.flaggedAsMine||t&&t.row==s.row&&t.col==s.col||(s.flaggedAsMine=!0,t?s.drawMine():s.drawFlag(!0))}},showSeconds:function(t){var i=new Number(t);this.lblSeconds.string=i.toFixed(1)+"s"},playAudio:function(t){"win"==t?cc.audioEngine.playEffect(this.audioWin,!1):"explode"==t?cc.audioEngine.playEffect(this.audioExplode,!1,.4):"opening"==t?cc.audioEngine.playEffect(this.audioOpening,!1,.1):"click"==t?cc.audioEngine.playEffect(this.audioClick,!1):"flag"==t&&cc.audioEngine.playEffect(this.audioFlag,!1)},update:function(t){this.seconds>-1&&(this.seconds+=t,this.showSeconds(this.seconds))}}),cc._RF.pop()},{}],Square:[function(t,i,e){"use strict";cc._RF.push(i,"4cd0eYyWzdMCZHGTkS53iZF","Square"),cc.Class({extends:cc.Component,properties:{imgFlag:cc.Node,imgRedMine:cc.Node,imgBlackMine:cc.Node,texNumber:{default:[],type:cc.SpriteFrame}},init:function(t,i,e){this.shouldOpenSquare=null,this.isRevealed=!1,this.flaggedAsMine=!1,this.animationScale=0,this.isMine=!1,this.number=0,this.row=t,this.col=i,this.node.width=e,this.node.height=e},drawSquareNumber:function(t){this.getComponent("cc.Sprite").spriteFrame=this.texNumber[t]},drawFlag:function(t){this.imgFlag.active=t},drawMine:function(t){t?this.imgRedMine.active=!0:this.imgBlackMine.active=!0},getSurroundingMineCount:function(){return this.visitSurrounding(function(t){return t.isMine})},getSurroundingFlaggedCount:function(){return this.visitSurrounding(function(t){return t.flaggedAsMine})},getSurroundingUnrevealedCount:function(){return this.visitSurrounding(function(t){return!t.isRevealed})},visitSurrounding:function(t){var i=this.row,e=this.col,o=this.board.rows,n=this.board.cols;return 0==i&&0==e?this.countBelow(t)+this.countRight(t)+this.countBelowRight(t):0==i&&e==n-1?this.countLeft(t)+this.countBelowLeft(t)+this.countBelow(t):i==o-1&&0==e?this.countRight(t)+this.countAboveRight(t)+this.countAbove(t):i==o-1&&e==n-1?this.countLeft(t)+this.countAboveLeft(t)+this.countAbove(t):0==i?this.countLeft(t)+this.countRight(t)+this.countBelowLeft(t)+this.countBelowRight(t)+this.countBelow(t):i==o-1?this.countLeft(t)+this.countRight(t)+this.countAboveLeft(t)+this.countAboveRight(t)+this.countAbove(t):0==e?this.countRight(t)+this.countAboveRight(t)+this.countAbove(t)+this.countBelow(t)+this.countBelowRight(t):e==n-1?this.countLeft(t)+this.countAboveLeft(t)+this.countAbove(t)+this.countBelow(t)+this.countBelowLeft(t):this.countLeft(t)+this.countRight(t)+this.countAboveLeft(t)+this.countAboveRight(t)+this.countAbove(t)+this.countBelow(t)+this.countBelowLeft(t)+this.countBelowRight(t)},countAbove:function(t){return t(this.board.map[this.row-1][this.col])?1:0},countAboveRight:function(t){return t(this.board.map[this.row-1][this.col+1])?1:0},countAboveLeft:function(t){return t(this.board.map[this.row-1][this.col-1])?1:0},countBelow:function(t){return t(this.board.map[this.row+1][this.col])?1:0},countBelowRight:function(t){return t(this.board.map[this.row+1][this.col+1])?1:0},countBelowLeft:function(t){return t(this.board.map[this.row+1][this.col-1])?1:0},countRight:function(t){return t(this.board.map[this.row][this.col+1])?1:0},countLeft:function(t){return t(this.board.map[this.row][this.col-1])?1:0},uncoverAbove:function(){return this.board.map[this.row-1][this.col].uncoverSquare()},uncoverAboveRight:function(){return this.board.map[this.row-1][this.col+1].uncoverSquare()},uncoverAboveLeft:function(){return this.board.map[this.row-1][this.col-1].uncoverSquare()},uncoverBelow:function(){return this.board.map[this.row+1][this.col].uncoverSquare()},uncoverBelowRight:function(){return this.board.map[this.row+1][this.col+1].uncoverSquare()},uncoverBelowLeft:function(){return this.board.map[this.row+1][this.col-1].uncoverSquare()},uncoverRight:function(){return this.board.map[this.row][this.col+1].uncoverSquare()},uncoverLeft:function(){return this.board.map[this.row][this.col-1].uncoverSquare()},doOpening:function(){var t=this.row,i=this.col,e=this.board.rows,o=this.board.cols;return 0==t&&0==i?(this.uncoverBelow(),this.uncoverRight(),void this.uncoverBelowRight()):0==t&&i==o-1?(this.uncoverLeft(),this.uncoverBelowLeft(),void this.uncoverBelow()):t==e-1&&0==i?(this.uncoverRight(),this.uncoverAboveRight(),void this.uncoverAbove()):t==e-1&&i==o-1?(this.uncoverLeft(),this.uncoverAboveLeft(),void this.uncoverAbove()):0==t?(this.uncoverLeft(),this.uncoverRight(),this.uncoverBelowLeft(),this.uncoverBelowRight(),void this.uncoverBelow()):t==e-1?(this.uncoverLeft(),this.uncoverRight(),this.uncoverAboveLeft(),this.uncoverAboveRight(),void this.uncoverAbove()):0==i?(this.uncoverRight(),this.uncoverAboveRight(),this.uncoverAbove(),this.uncoverBelow(),void this.uncoverBelowRight()):i==o-1?(this.uncoverLeft(),this.uncoverAboveLeft(),this.uncoverAbove(),this.uncoverBelow(),void this.uncoverBelowLeft()):(this.uncoverRight(),this.uncoverAboveLeft(),this.uncoverAboveRight(),this.uncoverAbove(),this.uncoverBelow(),this.uncoverBelowRight(),this.uncoverBelowLeft(),void this.uncoverLeft())},markWithFlag:function(){var t=this.board;this.isRevealed||(this.flaggedAsMine?(t.minesFlagged--,this.flaggedAsMine=!1,this.drawFlag(!1)):(t.minesFlagged++,this.flaggedAsMine=!0,this.drawFlag(!0),t.playAudio("flag")))},uncoverSquare:function(){var t=this,i=t.row,e=t.col,o=t.board;if(!t.flaggedAsMine&&!t.isRevealed){if(0==o.squaresRevealed&&((t.getSurroundingMineCount()>0||t.isMine)&&o.regenerate(t),t=o.map[i][e]),t.isMine)return console.log("loseGame"),void o.loseGame(t);var n=t.getSurroundingMineCount();return t.isRevealed=!0,o.squaresRevealed++,t.drawSquareNumber(n),0===n&&(o.playAudio("opening"),this.shouldOpenSquare=t),0===o.squaresRemaining()?(console.log("winGame"),void o.winGame()):void 0}},clearAround:function(){var t=this.getSurroundingMineCount(),i=this.getSurroundingFlaggedCount();if(t==i&&i>0){var e=this.uncoverSquare;this.visitSurrounding(function(t){return e.call(t),!0})}},equal:function(t){return t.row===this.row&&t.col===this.col},update:function(){this.shouldOpenSquare&&(this.shouldOpenSquare.doOpening(),this.shouldOpenSquare=!1)}}),cc._RF.pop()},{}]},{},["Demo","Square"]);